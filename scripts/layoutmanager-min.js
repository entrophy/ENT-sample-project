(function(a,b,c){function d(a){b.each(a,function(a,b){this.view(b,a)},this)}function e(a,c){function i(a){var b=h.deferred();return b.async=function(){return b._isAsync=!0,a},b.partial=h.deferred(),b}function j(a){function m(b,d){f.cache(c,d),h.html(a.el,h.render(d,b)),e.partial.resolve(a.el),l(a,a.views)}var c,e,j,k;return a.views={},{insert:function(b,c){var e=a.views,f=e[b]=e[b]||[];return f.push(c),c.view=a,c.setViews=d,c},render:function(d){return!d&&b.isFunction(a.serialize)?d=a.serialize.call(a):!d&&b.isObject(a.serialize)&&(d=a.serialize),e=i(b.bind(m,g,d)),j=h.paths&&h.paths.template||"",b.isString(a.template)&&(c=j+a.template),(k=f.cache(c))?(m(d,k,c),e):(b.isString(a.template)?k=h.fetch.call(e,j+a.template):k=h.fetch.call(e,a.template),e._isAsync||m(d,k),e)}}}function k(a,c,d){var e=d.render;return function(){d.remove();var f=e.call(d,j);return f.partial.then(function(e){h.partial(a.el,c,e,d.options.append),f.resolve(d.el).then(function(a){d.delegateEvents()});if(b.isObject(d.options.views))return l(d,d.options.views)}),f}}function l(a,c){function d(b,c,d){b.remove(),b.render._wrapped||(b.render=k(a,c,b),b.render._wrapped=!0),b.render().then(d)}b.each(c,function(c,e){function f(a){var b=a.shift();b.options.append=!0,d(b,e,function(){a.length&&f(a)})}b.isArray(c)?(h.partial(a.el,e,""),f(b.clone(c))):d(c,e)})}var g=this,h=this.options;return c.render._wrapped||(c.render=k(g,a,c),c.render._wrapped=!0),c.view=e,c.setViews=d,this.views[a]=c}var f=a.LayoutManager=a.View.extend({initialize:function(){var c,d,e={},f=this;b.isFunction(this.options.views)?(b.extend(e,this.options.views.call(this)),delete this.options.views):b.isObject(this.options.views)&&(b.extend(e,this.options.views),delete this.options.views),this.views={},b.each(e,function(a,b){f.view(b,a)}),this.options=b.extend({},a.LayoutManager,this.options),b.isFunction(this.options.initialize)&&this.options.initialize.apply(this,arguments),b.bindAll(this),b.each(["template","serialize"],function(a){!this.options[a]&&this[a]&&(this.options[a]=this[a])},this),this.options.events&&(this.events=this.options.events,delete this.options.events,b.each(this.events,function(a){this[a]=this.options[a],delete this.options[a]},this),this.delegateEvents())},view:e,setViews:d,render:function(a){function j(a){var b=i.deferred();return b.async=function(){return b._isAsync=!0,a},b.partial=i.deferred(),b}function k(c){var d={};f.cache(e,c),b.isFunction(i.serialize)?d=i.serialize.call(h):b.isObject(i.serialize)&&(d=i.serialize),i.html(h.el,i.render(c,d)),b.each(h.views,function(a){a.render()}),a(h.el)}var c,d,e,g,h=this,i=this.options;d=i.paths&&i.paths.layout||"",b.isString(i.template)?e=d+i.template:e=i.template;if(c=f.cache(e))return k(c);g=j(k),c=i.fetch.call(g,e);if(!g._isAsync)return console.log("here"),k(c)}},{_cache:{},cache:function(a,b){if(a in this._cache)return this._cache[a];if(a!=null&&b!=null)return this._cache[a]=b},configure:function(c){var d=a.LayoutManager.prototype.options;b.isObject(c)&&b.extend(d,c)},View:a.View.extend({render:function(a){return a(this).render()}})});a.LayoutManager.prototype.options={paths:{},deferred:function(){return c.Deferred()},fetch:function(a){return c(a).html()},partial:function(a,b,d,e){e?this.append(c(a).find(b),d):this.html(c(a).find(b),d)},html:function(a,b){c(a).html(b)},append:function(a,b){c(a).append(b)},render:function(a,c){return b.template(a)(c)}}})(this.Backbone,this._,this.jQuery)

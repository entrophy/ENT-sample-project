(function(a,b,c){function g(a){b.each(a,function(a,b){this.view(b,a)},this)}function h(a,c){function i(a){var b=f.deferred();return b.async=function(){return b._isAsync=!0,a},b.partial=f.deferred(),b}function j(a){function n(b,e){d.cache(c,e),f.html(a.el,f.render(e,b)),j.partial.resolve(a.el),l(a,a.views)}var c,j,k,m;return a.views={},{insert:function(b,c){var d=a.views,e=d[b]=d[b]||[];return e.push(c),c.view=h,c.setViews=g,c},render:function(g){return!g&&b.isFunction(a.serialize)?g=a.serialize.call(a):!g&&b.isObject(a.serialize)&&(g=a.serialize),j=i(b.bind(n,e,g)),k=f.paths&&f.paths.template||"",b.isString(a.template)&&(c=k+a.template),(m=d.cache(c))?(n(g,m,c),j):(b.isString(a.template)?m=f.fetch.call(j,k+a.template):m=f.fetch.call(j,a.template),j._isAsync||n(g,m),j)}}}function k(a,c,d){var e,g=d.render;return function(){var h=g.call(d,j);return e?(b.isObject(d.options.views)&&l(d,d.options.views),h.partial.then(function(a){return h.resolve(a)}),h):(h.partial.then(function(g){f.partial(a.el,c,g,d.options.append),e=!0,h.resolve(d.el),b.isObject(d.options.views)&&l(d,d.options.views)}),h)}}function l(a,c){function d(b,c,d){b.remove(),b.render._wrapped||(b.render=k(a,c,b),b.render._wrapped=!0),b.render().then(d).then(function(){b.delegateEvents()})}b.each(c,function(a,c){function e(a){var b=a.shift();b.options.append=!0,d(b,c,function(){a.length&&e(a)})}b.isArray(a)?e(b.clone(a)):d(a,c)})}var e=this,f=b.extend({},this.options,d.prototype.options);return c.render._wrapped||(c.render=k(e,a,c),c.render._wrapped=!0),c.view=h,c.setViews=g,this.views[a]=c}var d,e,f;d=a.LayoutManager=a.View.extend({initialize:function(){var c,d,e={},f=this;b.isFunction(this.options.views)?(b.extend(e,this.options.views.call(this)),delete this.options.views):b.isObject(this.options.views)&&(b.extend(e,this.options.views),delete this.options.views),this.views={},b.each(e,function(a,b){f.view(b,a)}),this.options=b.extend({},a.LayoutManager,this.options),b.isFunction(this.options.initialize)&&this.options.initialize.apply(this,arguments),b.bindAll(this),b.each(["template","serialize"],function(a){!this.options[a]&&this[a]&&(this.options[a]=this[a])},this),this.options.events&&(this.events=this.options.events,delete this.options.events,b.each(this.events,function(a){this[a]=this.options[a],delete this.options[a]},this),this.delegateEvents())},view:h,setViews:g,render:function(a){function j(a){var b=i.deferred();return b.async=function(){return b._isAsync=!0,a},b.partial=i.deferred(),b}function k(c){var e={};d.cache(f,c),b.isFunction(i.serialize)?e=i.serialize.call(h):b.isObject(i.serialize)&&(e=i.serialize),i.html(h.el,i.render(c,e)),i.detach(h.el),b.each(h.views,function(a){a.render()}),a(h.el)}var c,e,f,g,h=this,i=this.options;e=i.paths&&i.paths.layout||"",b.isString(i.template)?f=e+i.template:f=i.template;if(c=d.cache(f))return k(c);g=j(k),c=i.fetch.call(g,f),g._isAsync||k(c)}},{_cache:{},cache:function(a,b){if(a in this._cache)return this._cache[a];if(a!=null&&b!=null)return this._cache[a]=b},configure:function(c){var d=a.LayoutManager.prototype.options;b.isObject(c)&&b.extend(d,c)},View:a.View.extend({render:function(a){return a(this).render()}})}),a.LayoutManager.prototype.options={paths:{},deferred:function(){return c.Deferred()},fetch:function(a){return c(a).html()},partial:function(a,b,d,e){e?this.append(c(a).find(b),d):this.html(c(a).find(b),d)},html:function(a,b){c(a).html(b)},append:function(a,b){c(a).append(b)},detach:function(a){c(a).detach()},render:function(a,c){return b.template(a)(c)}}})(this.Backbone,this._,this.jQuery)
